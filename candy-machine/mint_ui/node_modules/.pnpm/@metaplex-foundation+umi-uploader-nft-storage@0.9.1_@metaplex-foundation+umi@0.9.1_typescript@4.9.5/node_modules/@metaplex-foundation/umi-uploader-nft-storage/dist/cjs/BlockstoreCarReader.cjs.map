{"version":3,"file":"BlockstoreCarReader.cjs","sources":["../../src/BlockstoreCarReader.ts"],"sourcesContent":["import type { Blockstore } from 'ipfs-car/blockstore';\nimport type { CID } from 'multiformats';\n\n/**\n * An implementation of the CAR reader interface that is backed by a blockstore.\n * @see https://github.com/nftstorage/nft.storage/blob/0fc7e4e73867c437eac54f75f58a808dd4581c47/packages/client/src/bs-car-reader.js\n */\nexport class BlockstoreCarReader {\n  _version: number;\n\n  _roots: CID[];\n\n  _blockstore: Blockstore;\n\n  constructor(roots: CID[], blockstore: Blockstore, version = 1) {\n    this._version = version;\n    this._roots = roots;\n    this._blockstore = blockstore;\n  }\n\n  get version() {\n    return this._version;\n  }\n\n  get blockstore() {\n    return this._blockstore;\n  }\n\n  async getRoots() {\n    return this._roots;\n  }\n\n  has(cid: CID) {\n    return this._blockstore.has(cid);\n  }\n\n  async get(cid: CID) {\n    const bytes = await this._blockstore.get(cid);\n    return { cid, bytes };\n  }\n\n  blocks(): ReturnType<Blockstore['blocks']> {\n    return this._blockstore.blocks();\n  }\n\n  async *cids() {\n    // eslint-disable-next-line no-restricted-syntax\n    for await (const b of this.blocks()) {\n      yield b.cid;\n    }\n  }\n}\n"],"names":["BlockstoreCarReader","constructor","roots","blockstore","version","_version","_roots","_blockstore","getRoots","has","cid","get","bytes","blocks","cids","b"],"mappings":";;;;AAGA;AACA;AACA;AACA;AACO,MAAMA,mBAAmB,CAAC;EAO/BC,WAAW,CAACC,KAAY,EAAEC,UAAsB,EAAEC,OAAO,GAAG,CAAC,EAAE;IAC7D,IAAI,CAACC,QAAQ,GAAGD,OAAO,CAAA;IACvB,IAAI,CAACE,MAAM,GAAGJ,KAAK,CAAA;IACnB,IAAI,CAACK,WAAW,GAAGJ,UAAU,CAAA;AAC/B,GAAA;AAEA,EAAA,IAAIC,OAAO,GAAG;IACZ,OAAO,IAAI,CAACC,QAAQ,CAAA;AACtB,GAAA;AAEA,EAAA,IAAIF,UAAU,GAAG;IACf,OAAO,IAAI,CAACI,WAAW,CAAA;AACzB,GAAA;AAEA,EAAA,MAAMC,QAAQ,GAAG;IACf,OAAO,IAAI,CAACF,MAAM,CAAA;AACpB,GAAA;EAEAG,GAAG,CAACC,GAAQ,EAAE;AACZ,IAAA,OAAO,IAAI,CAACH,WAAW,CAACE,GAAG,CAACC,GAAG,CAAC,CAAA;AAClC,GAAA;EAEA,MAAMC,GAAG,CAACD,GAAQ,EAAE;IAClB,MAAME,KAAK,GAAG,MAAM,IAAI,CAACL,WAAW,CAACI,GAAG,CAACD,GAAG,CAAC,CAAA;IAC7C,OAAO;MAAEA,GAAG;AAAEE,MAAAA,KAAAA;KAAO,CAAA;AACvB,GAAA;AAEAC,EAAAA,MAAM,GAAqC;AACzC,IAAA,OAAO,IAAI,CAACN,WAAW,CAACM,MAAM,EAAE,CAAA;AAClC,GAAA;AAEA,EAAA,OAAOC,IAAI,GAAG;AACZ;AACA,IAAA,WAAW,MAAMC,CAAC,IAAI,IAAI,CAACF,MAAM,EAAE,EAAE;MACnC,MAAME,CAAC,CAACL,GAAG,CAAA;AACb,KAAA;AACF,GAAA;AACF;;;;"}